# Python Code Generator

A sophisticated Python script generator that creates diverse, realistic code samples using various LLM models. This tool simulates real-world code with different coding styles, practices, and common patterns found in production environments.

## Project Structure

```
armor1/
â”œâ”€â”€ config.json               # Configuration file with API keys
â”œâ”€â”€ config.template.json      # Template for config.json
â”œâ”€â”€ script/
â”‚   â”œâ”€â”€ prompt_gen.py        # Main script for generating Python code
â”‚   â”œâ”€â”€ extract_attributes.py # Script for analyzing generated code
â”‚   â””â”€â”€ generate_analysis_report.py # Script for generating HTML report
â”œâ”€â”€ generated/               # Directory containing generated Python files
â”œâ”€â”€ analysis_results.json    # Analysis results from extract_attributes.py
â”œâ”€â”€ analysis_results.html    # HTML report generated by generate_analysis_report.py
â”œâ”€â”€ venv/                    # Python virtual environment (not tracked in git)
â”œâ”€â”€ .gitignore               # Git ignore configuration
â””â”€â”€ README.md               # Project documentation
```

## Main Components

### prompt_gen.py

The core script that handles code generation using multiple LLM models. Key features include:

1. **Model Selection**
   - Randomly selects from multiple LLM models for diverse code generation:
     - Deepseek-v3
     - Llama-v3p1-405b-instruct
     - Llama-v3p3-70b-instruct
     - Qwen2p5-coder-32b-instruct
     - Mixtral-8x22b-instruct
     - Qwen2p5-72b-instruct

2. **Code Generation**
   - Generates 15-25 unique Python scripts per run
   - Each script gets a unique UUID in its filename
   - Supports both script and class templates
   - Extracts clean Python code from markdown responses

3. **Randomization Features**
   - Random data sources (databases, APIs, file systems)
   - Random issues and edge cases
   - Random features and complexity levels
   - Varying code quality and practices

4. **Script Types Generated**
   - Data processors
   - API clients
   - Authentication systems
   - Data models
   - Task processors
   - Cache managers
   - Configuration handlers
   - Log processors
   - And more...

### Generated Code Characteristics

The generated code intentionally simulates real-world scenarios with:

1. **Documentation Variety**
   - Mixed levels of documentation
   - Some functions with detailed docstrings
   - Others with minimal or no documentation
   - TODOs and FIXMEs

2. **Code Quality Variation**
   - Inconsistent naming conventions
   - Mixed error handling approaches
   - Various levels of code organization
   - Both good and bad practices

3. **Real-world Complexity**
   - Multiple data sources and sinks
   - Error handling and edge cases
   - Security considerations
   - Performance implications
   - Legacy compatibility issues

4. **Common Issues**
   - Race conditions
   - Memory leaks
   - API limitations
   - Error handling gaps
   - Technical debt indicators

## Features

### Code Analysis Tool
The `extract_attributes.py` script analyzes the generated Python code to extract key attributes:

- **Analysis Features**:
  - File metadata (name, size, type)
  - Data models and their fields
  - Data sources (databases, files, APIs)
  - Data sinks (output destinations)
  - Field types and annotations

- **Output Format**:
  ```json
  [
    {
      "file_name": "data_model_abc123.py",
      "data_models": [
        {
          "class_name": "User",
          "fields": ["id", "name", "email"],
          "field_types": {
            "id": "int",
            "name": "str",
            "email": "str"
          },
          "docstring": "User data model..."
        }
      ],
      "data_sources": ["database:query", "api:get"],
      "data_sinks": ["database:insert", "file:write"]
    }
  ]
  ```

- **Usage**:
  ```bash
  python3 script/extract_attributes.py
  ```
  The script will analyze all Python files in the `generated` directory and output the results to `analysis_results.json`.

### Smart Distribution Balancing
The script generator now includes intelligent distribution balancing of generated code types:

- **Target Distribution**:
  - Data Processors: 15%
  - API Clients: 15%
  - Auth Handlers: 10%
  - Data Models: 15%
  - Task Processors: 10%
  - Cache Managers: 10%
  - Config Handlers: 10%
  - Log Processors: 15%

- **Distribution Analysis**: On each run, the script:
  1. Analyzes existing files in the `generated` directory
  2. Calculates current distribution percentages
  3. Shows distribution stats before and after generation
  4. Uses weighted selection to favor under-represented types

- **Visual Progress Tracking**:
  ```
  ðŸ“Š Current Distribution:
    data_processor: 12.5% (5 files) â†“
    api_client: 15.0% (6 files) â†’
    auth_handler: 7.5% (3 files) â†“
    ...
  ```
  Arrows indicate: â†‘ (above target), â†“ (below target), â†’ (at target)

### Randomization Features
- Random data sources (databases, APIs, file systems)
- Random issues and edge cases
- Random features and complexity levels
- Varying code quality and practices

## Scripts

The project contains several Python scripts in the `script` directory:

- `prompt_gen.py`: Generates Python scripts using the Fireworks AI API. Features smart distribution balancing to ensure a diverse set of generated scripts.
- `extract_attributes.py`: Uses AST parsing to analyze generated Python scripts and extract key attributes like data models, fields, data sources, and data sinks.
- `generate_analysis_report.py`: Creates a beautiful HTML report from the analysis results, allowing easy viewing of the code analysis.

## Configuration

1. Copy `config.template.json` to `config.json`
2. Add your Fireworks AI API key to `config.json`:
   ```json
   {
     "fireworks_api_key": "your-api-key-here"
   }
   ```

## Viewing Analysis Results

Follow these steps to generate and view the analysis results:

1. **Generate Source Files**
   ```bash
   python3 script/prompt_gen.py
   ```
   This will create Python scripts in the `generated` directory using the Fireworks AI API.

2. **Extract Code Attributes**
   ```bash
   python3 script/extract_attributes.py
   ```
   This script will:
   - Parse all Python files in the `generated` directory using AST
   - Extract data models, fields, data sources, and sinks
   - Create `analysis_results.json` with the findings

3. **Generate HTML Report**
   ```bash
   python3 script/generate_analysis_report.py
   ```
   This creates `analysis_results.html`, a beautifully formatted report showing:
   - Total number of files, models, and fields
   - Table with file details including models, sources, and sinks
   - Interactive features to view source code

4. **View the Report**
   ```bash
   # Start a local HTTP server in the project root
   python3 -m http.server 8000
   ```
   Then open your browser and navigate to:
   ```
   http://localhost:8000/analysis_results.html
   ```

The HTML report provides an easy way to:
- View statistics about your generated code
- See what data models are present in each file
- View the source code of any file by clicking its name
- Analyze data sources and sinks used in the code

## Usage

### Getting Started

#### API Key Configuration

1. **Get a Fireworks AI API Key**:
   - Visit [fireworks.ai](https://fireworks.ai)
   - Sign up or log in to your account
   - Navigate to your dashboard
   - Generate a new API key

2. **Configure the API Key**:
   - Create a `config.json` file in the project root:
     ```bash
     cp config.template.json config.json
     ```
   - Open `config.json` and add your API key:
     ```json
     {
         "fireworks_api": {
             "api_key": "fw_your_api_key_here"
         }
     }
     ```
   - Replace `fw_your_api_key_here` with your actual Fireworks AI API key
   - The file is already in `.gitignore` to prevent accidental commits

3. **Verify Configuration**:
   - The script will validate your API key on startup
   - If the key is invalid or missing, you'll see a helpful error message
   - Never commit your `config.json` file to version control

#### Setup Virtual Environment

1. **Setup Virtual Environment**
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Unix/macOS
   pip install requests
   ```

2. **Configure API Key**
   - Set your Fireworks AI API key in the script
   - Never commit API keys to version control

3. **Run the Generator**
   ```bash
   python script/prompt_gen.py
   ```

4. **Generated Files**
   - Check the `generated/` directory for output files
   - Each file will have a format: `{type}_{uuid}.py`
   - Example: `data_processor_a1b2c3d4.py`

## Generated Code Examples

The tool generates various types of Python scripts, such as:

1. **Data Processing**
   ```python
   data_processor_uuid.py  # Handles multiple data sources
   log_processor_uuid.py   # Processes various log formats
   ```

2. **API Integration**
   ```python
   api_client_uuid.py      # Integrates with external services
   http_client_uuid.py     # Handles HTTP communications
   ```

3. **System Management**
   ```python
   cache_manager_uuid.py   # Manages caching layers
   config_handler_uuid.py  # Handles configuration
   ```

## Notes

- Generated code intentionally includes varying quality to simulate real-world scenarios
- Each run produces different results due to randomization
- The `generated/` directory is git-ignored as files are meant to be regenerated
- Code may contain intentional anti-patterns and common issues found in production

## Requirements

- Python 3.6+
- `requests` library
- Fireworks AI API key
- Virtual environment (recommended)

## Contributing

Feel free to contribute by:
1. Adding new script types
2. Improving templates
3. Adding more randomization features
4. Enhancing code generation patterns
